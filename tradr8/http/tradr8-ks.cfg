# Rocky Linux 8 Kickstart File

# System bootloader configuration
bootloader --location=mbr --timeout=1

# Clear the Master Boot Record
zerombr
clearpart --all --initlabel

# Partitioning
part / --fstype="xfs" --size=10240
part /boot --fstype="xfs" --size=512
part swap --size=2048

# Network configuration
network --bootproto=dhcp --device=eth0 --onboot=yes

# Disable SELinux
selinux --disabled

# Firewall configuration (disabling)
firewall --disabled

# Set timezone
timezone Europe/London --isUtc

# Keyboard and language settings
keyboard gb
lang en_GB.UTF-8

# Root password
rootpw --plaintext vagrant

# Create vagrant user
user --name=vagrant --groups=wheel --password= --plaintext --shell=/bin/bash

# SSH enabled
services --enabled=sshd

# Installation source
url --url="http://mirror.centos.org/centos/8-stream/BaseOS/x86_64/os/"

# System authorization
auth --enableshadow --passalgo=sha512

# Automatically reboot after installation
reboot

# Skip the first boot setup
firstboot --disable

# Packages
%packages
@core
@standard
wget
curl
vim
net-tools
%end

# Post-installation script
%post --interpreter=/bin/bash

# Enable passwordless sudo for the vagrant user
echo 'vagrant ALL=(ALL) NOPASSWD: ALL' >> /etc/sudoers.d/vagrant
chmod 0440 /etc/sudoers.d/vagrant

# Install Vagrant SSH key
mkdir -p /home/vagrant/.ssh
curl -L https://raw.githubusercontent.com/hashicorp/vagrant/main/keys/vagrant.pub -o /home/vagrant/.ssh/authorized_keys
chmod 0700 /home/vagrant/.s
